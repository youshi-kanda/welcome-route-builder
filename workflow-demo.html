<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALSOKæ¡ç”¨ã‚·ã‚¹ãƒ†ãƒ  - å®Œå…¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä½“é¨“</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
        }
        .step-active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }
        .step-completed {
            background: linear-gradient(135deg, #10b981, #047857);
            color: white;
        }
        .step-pending {
            background: #f3f4f6;
            color: #6b7280;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8">
        
        <!-- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é€²è¡Œè¡¨ç¤º -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h1 class="text-2xl font-bold text-center mb-6">ğŸ›¡ï¸ ALSOKæ¡ç”¨ã‚·ã‚¹ãƒ†ãƒ  - å®Œå…¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä½“é¨“</h1>
            
            <!-- ã‚¹ãƒ†ãƒƒãƒ—é€²è¡Œãƒãƒ¼ -->
            <div class="flex items-center justify-between mb-6">
                <div id="step-1" class="step-active flex-1 mx-1 p-3 rounded-lg text-center text-sm font-medium">
                    1ï¸âƒ£ é›»è©±å—ä»˜
                </div>
                <div class="text-gray-400">â†’</div>
                <div id="step-2" class="step-pending flex-1 mx-1 p-3 rounded-lg text-center text-sm font-medium">
                    2ï¸âƒ£ SMSé€ä¿¡
                </div>
                <div class="text-gray-400">â†’</div>
                <div id="step-3" class="step-pending flex-1 mx-1 p-3 rounded-lg text-center text-sm font-medium">
                    3ï¸âƒ£ QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
                </div>
                <div class="text-gray-400">â†’</div>
                <div id="step-4" class="step-pending flex-1 mx-1 p-3 rounded-lg text-center text-sm font-medium">
                    4ï¸âƒ£ AIé¢æ¥
                </div>
                <div class="text-gray-400">â†’</div>
                <div id="step-5" class="step-pending flex-1 mx-1 p-3 rounded-lg text-center text-sm font-medium">
                    5ï¸âƒ£ çµæœç¢ºèª
                </div>
            </div>
            
            <!-- ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—èª¬æ˜ -->
            <div id="step-description" class="text-center p-4 bg-blue-50 rounded-lg">
                <p class="text-lg font-medium text-blue-900">ã‚¹ãƒ†ãƒƒãƒ—1: é›»è©±å—ä»˜ã‚’é–‹å§‹ã—ã¦ãã ã•ã„</p>
                <p class="text-sm text-blue-700 mt-2">å¿œå‹Ÿè€…ã‹ã‚‰ã®é›»è©±ã‚’å—ã‘ä»˜ã‘ã¦ã€æ¡ç”¨ãƒ—ãƒ­ã‚»ã‚¹ã‚’é–‹å§‹ã—ã¾ã™</p>
            </div>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- å·¦ã‚«ãƒ©ãƒ : ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”»é¢ -->
            <div class="space-y-6">
                
                <!-- ã‚¹ãƒ†ãƒƒãƒ—1: é›»è©±å—ä»˜ -->
                <div id="phone-section" class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        ğŸ“ é›»è©±å—ä»˜ã‚·ã‚¹ãƒ†ãƒ 
                    </h3>
                    
                    <div id="phone-form">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">ãŠåå‰</label>
                                <input type="text" id="applicant-name" class="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="å±±ç”°å¤ªéƒ" value="å±±ç”°å¤ªéƒ">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">é›»è©±ç•ªå·</label>
                                <input type="tel" id="applicant-phone" class="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="090-1234-5678" value="090-1234-5678">
                            </div>
                            <button onclick="startPhoneCall()" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                                ğŸ“ æ¡ç”¨çª“å£ã¸ã®é›»è©±ã‚’é–‹å§‹
                            </button>
                        </div>
                    </div>
                    
                    <div id="phone-progress" class="hidden">
                        <div class="text-center py-6">
                            <div id="call-animation" class="text-6xl mb-4">ğŸ“</div>
                            <p id="call-status" class="text-lg font-medium mb-4">å‘¼ã³å‡ºã—ä¸­...</p>
                            <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
                                <div id="call-progress-bar" class="bg-green-600 h-2 rounded-full transition-all duration-1000" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ã‚¹ãƒ†ãƒƒãƒ—4: AIé¢æ¥ -->
                <div id="interview-section" class="hidden bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        ğŸ¤– AIé¢æ¥ã‚·ã‚¹ãƒ†ãƒ 
                    </h3>
                    
                    <div class="mb-4">
                        <p class="text-sm text-gray-600">è³ªå• <span id="question-number">1</span> / 5</p>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                            <div id="interview-progress-bar" class="bg-orange-600 h-2 rounded-full transition-all duration-300" style="width: 20%"></div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-400">
                            <p id="current-question" class="font-medium">è‡ªå·±ç´¹ä»‹ã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼ˆãŠåå‰ã€å¹´é½¢ã€è·æ­´ãªã©ï¼‰</p>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <textarea id="interview-answer" class="w-full min-h-[100px] border border-gray-300 rounded-lg px-3 py-2" placeholder="ã“ã¡ã‚‰ã«å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
                    </div>
                    
                    <button onclick="submitAnswer()" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                        ğŸ“¤ <span id="submit-btn-text">å›ç­”ã‚’é€ä¿¡</span>
                    </button>
                    
                    <div class="mt-4 text-sm text-gray-600 text-center">
                        å›ç­”æ¸ˆã¿: <span id="answered-count">0</span> å•
                    </div>
                </div>

                <!-- é¢æ¥å®Œäº† -->
                <div id="interview-completed" class="hidden bg-white rounded-xl shadow-lg p-6 text-center">
                    <div class="text-6xl mb-4">âœ…</div>
                    <h3 class="text-xl font-bold mb-2">é¢æ¥å®Œäº†ï¼</h3>
                    <p class="text-gray-600 mb-4">ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚çµæœã¯å¾Œæ—¥ã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚</p>
                    <div class="bg-gray-50 rounded-lg p-4 mb-4">
                        <p class="text-sm text-gray-600">å¿œå‹Ÿè€…ID: <span id="final-applicant-id" class="font-mono"></span></p>
                    </div>
                    <button onclick="resetWorkflow()" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded-lg">
                        ğŸ”„ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™
                    </button>
                </div>
            </div>
            
            <!-- å³ã‚«ãƒ©ãƒ : ç®¡ç†ç”»é¢ -->
            <div class="space-y-6">
                
                <!-- çµ±è¨ˆæƒ…å ± -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold mb-4">ğŸ“Š ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµ±è¨ˆ</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="text-center p-3 bg-blue-50 rounded-lg">
                            <div class="text-2xl font-bold text-blue-600" id="total-applicants">0</div>
                            <div class="text-sm text-gray-600">å¿œå‹Ÿè€…æ•°</div>
                        </div>
                        <div class="text-center p-3 bg-green-50 rounded-lg">
                            <div class="text-2xl font-bold text-green-600" id="sms-sent">0</div>
                            <div class="text-sm text-gray-600">SMSé€ä¿¡</div>
                        </div>
                        <div class="text-center p-3 bg-orange-50 rounded-lg">
                            <div class="text-2xl font-bold text-orange-600" id="interviews-started">0</div>
                            <div class="text-sm text-gray-600">é¢æ¥é–‹å§‹</div>
                        </div>
                        <div class="text-center p-3 bg-purple-50 rounded-lg">
                            <div class="text-2xl font-bold text-purple-600" id="interviews-completed">0</div>
                            <div class="text-sm text-gray-600">é¢æ¥å®Œäº†</div>
                        </div>
                    </div>
                </div>

                <!-- QRã‚³ãƒ¼ãƒ‰ -->
                <div id="qr-section" class="hidden bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold mb-4">ğŸ“± é¢æ¥ç”¨QRã‚³ãƒ¼ãƒ‰</h3>
                    <div class="text-center">
                        <div id="qr-container" class="mb-4 flex justify-center">
                            <!-- QRã‚³ãƒ¼ãƒ‰ãŒã“ã“ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
                        </div>
                        <p class="text-sm text-gray-600 mb-4">ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦é¢æ¥ã‚’é–‹å§‹</p>
                        <div class="text-xs text-gray-500">
                            <p>URL: <span id="qr-url" class="font-mono break-all"></span></p>
                        </div>
                    </div>
                </div>

                <!-- å¿œå‹Ÿè€…ä¸€è¦§ -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold mb-4">ğŸ‘¥ å¿œå‹Ÿè€…ä¸€è¦§</h3>
                    <div id="applicants-list">
                        <div class="text-center py-6 text-gray-500">
                            <div class="text-3xl mb-2">ğŸ“‹</div>
                            <p class="text-sm">ã¾ã å¿œå‹Ÿè€…ãŒã„ã¾ã›ã‚“</p>
                        </div>
                    </div>
                </div>

                <!-- ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚° -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold mb-4">ğŸ“ ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°</h3>
                    <div id="system-logs" class="space-y-2 max-h-64 overflow-y-auto text-sm">
                        <div class="text-gray-500 text-center py-4">ã‚·ã‚¹ãƒ†ãƒ å¾…æ©Ÿä¸­...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let currentStep = 1;
        let currentApplicant = null;
        let applicants = [];
        let currentQuestionIndex = 0;
        let interviewResponses = [];
        
        const questions = [
            "è‡ªå·±ç´¹ä»‹ã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼ˆãŠåå‰ã€å¹´é½¢ã€è·æ­´ãªã©ï¼‰",
            "è­¦å‚™æ¥­ã«èˆˆå‘³ã‚’æŒã£ãŸãã£ã‹ã‘ã‚’æ•™ãˆã¦ãã ã•ã„",
            "å¤œå‹¤ã‚„ä¸è¦å‰‡ãªå‹¤å‹™æ™‚é–“ã«å¯¾å¿œã§ãã¾ã™ã‹ï¼Ÿ",
            "ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’é‡è¦–ã™ã‚‹å ´é¢ã§ã®çµŒé¨“ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ",
            "æœ€å¾Œã«ã€ALSOKã§åƒãæ„æ°—è¾¼ã¿ã‚’èã‹ã›ã¦ãã ã•ã„"
        ];

        const stepDescriptions = [
            { title: "é›»è©±å—ä»˜ã‚’é–‹å§‹ã—ã¦ãã ã•ã„", desc: "å¿œå‹Ÿè€…ã‹ã‚‰ã®é›»è©±ã‚’å—ã‘ä»˜ã‘ã¦ã€æ¡ç”¨ãƒ—ãƒ­ã‚»ã‚¹ã‚’é–‹å§‹ã—ã¾ã™" },
            { title: "SMSé€ä¿¡ä¸­ã§ã™", desc: "å¿œå‹Ÿè€…ã«é¢æ¥æ¡ˆå†…ã®SMSã‚’è‡ªå‹•é€ä¿¡ã—ã¦ã„ã¾ã™" },
            { title: "QRã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸ", desc: "å¿œå‹Ÿè€…ãŒã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§ã‚¹ã‚­ãƒ£ãƒ³ã§ãã‚‹QRã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºä¸­" },
            { title: "AIé¢æ¥ã‚’å®Ÿæ–½ã—ã¦ãã ã•ã„", desc: "å¿œå‹Ÿè€…ãŒé¢æ¥è³ªå•ã«å›ç­”ä¸­ã§ã™ã€‚é€²è¡ŒçŠ¶æ³ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç¢ºèªã§ãã¾ã™" },
            { title: "é¢æ¥çµæœã‚’ç¢ºèªã—ã¦ãã ã•ã„", desc: "é¢æ¥ãŒå®Œäº†ã—ã¾ã—ãŸã€‚çµæœã‚’ç¢ºèªã—ã¦æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã‚“ã§ãã ã•ã„" }
        ];

        // ãƒ­ã‚°è¿½åŠ é–¢æ•°
        function addLog(message, type = 'info') {
            const logsContainer = document.getElementById('system-logs');
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            const logEntry = document.createElement('div');
            
            let bgColor = 'bg-gray-50';
            let textColor = 'text-gray-700';
            let icon = 'ğŸ“';
            
            if (type === 'success') {
                bgColor = 'bg-green-50';
                textColor = 'text-green-700';
                icon = 'âœ…';
            } else if (type === 'phone') {
                bgColor = 'bg-blue-50';
                textColor = 'text-blue-700';
                icon = 'ğŸ“';
            } else if (type === 'sms') {
                bgColor = 'bg-yellow-50';
                textColor = 'text-yellow-700';
                icon = 'ğŸ“±';
            } else if (type === 'interview') {
                bgColor = 'bg-orange-50';
                textColor = 'text-orange-700';
                icon = 'ğŸ¤–';
            }
            
            logEntry.className = `${bgColor} ${textColor} p-2 rounded text-xs border-l-2 border-current`;
            logEntry.innerHTML = `<span class="font-mono text-xs">${timestamp}</span> ${icon} ${message}`;
            
            // å¤ã„ãƒ­ã‚°ãŒã‚ã‚Œã°å‰Šé™¤
            if (logsContainer.firstChild.textContent.includes('ã‚·ã‚¹ãƒ†ãƒ å¾…æ©Ÿä¸­')) {
                logsContainer.innerHTML = '';
            }
            
            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }

        // ã‚¹ãƒ†ãƒƒãƒ—æ›´æ–°é–¢æ•°
        function updateStep(step) {
            currentStep = step;
            
            // ã‚¹ãƒ†ãƒƒãƒ—ãƒãƒ¼ã®æ›´æ–°
            for (let i = 1; i <= 5; i++) {
                const stepElement = document.getElementById(`step-${i}`);
                if (i < step) {
                    stepElement.className = 'step-completed flex-1 mx-1 p-3 rounded-lg text-center text-sm font-medium';
                } else if (i === step) {
                    stepElement.className = 'step-active flex-1 mx-1 p-3 rounded-lg text-center text-sm font-medium';
                } else {
                    stepElement.className = 'step-pending flex-1 mx-1 p-3 rounded-lg text-center text-sm font-medium';
                }
            }
            
            // èª¬æ˜æ–‡ã®æ›´æ–°
            const description = stepDescriptions[step - 1];
            document.getElementById('step-description').innerHTML = `
                <p class="text-lg font-medium text-blue-900">${description.title}</p>
                <p class="text-sm text-blue-700 mt-2">${description.desc}</p>
            `;
        }

        // çµ±è¨ˆæ›´æ–°é–¢æ•°
        function updateStats() {
            document.getElementById('total-applicants').textContent = applicants.length;
            document.getElementById('sms-sent').textContent = applicants.filter(a => a.sms_sent).length;
            document.getElementById('interviews-started').textContent = applicants.filter(a => a.interview_started).length;
            document.getElementById('interviews-completed').textContent = applicants.filter(a => a.interview_completed).length;
        }

        // å¿œå‹Ÿè€…ä¸€è¦§æ›´æ–°é–¢æ•°
        function updateApplicantsList() {
            const container = document.getElementById('applicants-list');
            
            if (applicants.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-6 text-gray-500">
                        <div class="text-3xl mb-2">ğŸ“‹</div>
                        <p class="text-sm">ã¾ã å¿œå‹Ÿè€…ãŒã„ã¾ã›ã‚“</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = applicants.map(applicant => `
                <div class="border rounded-lg p-3 mb-2 ${applicant.interview_completed ? 'bg-green-50' : applicant.interview_started ? 'bg-orange-50' : 'bg-blue-50'}">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-medium text-sm">${applicant.name}</p>
                            <p class="text-xs text-gray-600">${applicant.phone}</p>
                            <p class="text-xs text-gray-500">ID: ${applicant.id}</p>
                        </div>
                        <div class="text-right">
                            <span class="text-xs px-2 py-1 rounded-full ${
                                applicant.interview_completed ? 'bg-green-100 text-green-800' :
                                applicant.interview_started ? 'bg-orange-100 text-orange-800' :
                                'bg-blue-100 text-blue-800'
                            }">
                                ${applicant.interview_completed ? 'é¢æ¥å®Œäº†' : applicant.interview_started ? 'é¢æ¥ä¸­' : 'SMSé€ä¿¡æ¸ˆ'}
                            </span>
                        </div>
                    </div>
                    ${applicant.interview_responses && applicant.interview_responses.length > 0 ? `
                        <div class="mt-2 text-xs text-gray-600">
                            å›ç­”æ•°: ${applicant.interview_responses.length}/5
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆé–¢æ•°
        function generateQRCode() {
            const mobileUrl = window.location.origin + window.location.pathname + '?mode=mobile&id=' + currentApplicant.id;
            document.getElementById('qr-url').textContent = mobileUrl;
            
            if (typeof QRCode !== 'undefined') {
                const container = document.getElementById('qr-container');
                container.innerHTML = '<canvas id="qrcode-canvas"></canvas>';
                
                QRCode.toCanvas(document.getElementById('qrcode-canvas'), mobileUrl, {
                    width: 200,
                    height: 200,
                    margin: 1,
                    color: {
                        dark: '#000000',
                        light: '#FFFFFF'
                    }
                }, function (error) {
                    if (error) {
                        console.error('QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                        container.innerHTML = '<div class="w-48 h-48 bg-gray-200 flex items-center justify-center rounded-lg text-gray-500">QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆä¸­...</div>';
                    }
                });
            } else {
                document.getElementById('qr-container').innerHTML = '<div class="w-48 h-48 bg-gray-200 flex items-center justify-center rounded-lg text-gray-500">QRã‚³ãƒ¼ãƒ‰èª­ã¿è¾¼ã¿ä¸­...</div>';
            }
        }

        // é›»è©±å—ä»˜é–‹å§‹
        function startPhoneCall() {
            const name = document.getElementById('applicant-name').value.trim();
            const phone = document.getElementById('applicant-phone').value.trim();
            
            if (!name || !phone) {
                alert('åå‰ã¨é›»è©±ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // å¿œå‹Ÿè€…æƒ…å ±ä½œæˆ
            currentApplicant = {
                id: 'APP' + Date.now().toString().slice(-6),
                name: name,
                phone: phone,
                sms_sent: false,
                interview_started: false,
                interview_completed: false,
                interview_responses: [],
                created_at: new Date().toISOString()
            };
            
            applicants.push(currentApplicant);
            
            addLog(`æ–°è¦å¿œå‹Ÿå—ä»˜: ${name} (${phone})`, 'phone');
            
            // é›»è©±ãƒ—ãƒ­ã‚»ã‚¹é–‹å§‹
            document.getElementById('phone-form').style.display = 'none';
            document.getElementById('phone-progress').classList.remove('hidden');
            
            updateStep(2);
            
            // é›»è©±å¿œå¯¾ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            const callSteps = [
                { text: "ğŸ“ å‘¼ã³å‡ºã—ä¸­...", progress: 25 },
                { text: "ğŸ¤– ã‚‚ã—ã‚‚ã—ã€ALSOKã§ã™ã€‚ãŠé›»è©±ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™", progress: 50 },
                { text: "ğŸ“ ãŠå®¢æ§˜æƒ…å ±ã‚’ç™»éŒ²ä¸­...", progress: 75 },
                { text: "ğŸ“± é¢æ¥æ¡ˆå†…ã®SMSã‚’é€ä¿¡ã—ã¦ã„ã¾ã™", progress: 100 }
            ];
            
            let stepIndex = 0;
            const interval = setInterval(() => {
                if (stepIndex < callSteps.length) {
                    const step = callSteps[stepIndex];
                    document.getElementById('call-animation').textContent = step.text.charAt(0);
                    document.getElementById('call-status').textContent = step.text;
                    document.getElementById('call-progress-bar').style.width = step.progress + '%';
                    
                    if (stepIndex === 1) {
                        addLog('è‡ªå‹•å¿œç­”ã‚·ã‚¹ãƒ†ãƒ æ¥ç¶šå®Œäº†', 'phone');
                    } else if (stepIndex === 2) {
                        addLog('å¿œå‹Ÿè€…æƒ…å ±ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ç™»éŒ²', 'success');
                    }
                    
                    stepIndex++;
                } else {
                    clearInterval(interval);
                    
                    // SMSé€ä¿¡å®Œäº†
                    currentApplicant.sms_sent = true;
                    addLog(`SMSé€ä¿¡å®Œäº†: ${currentApplicant.name} å®›ã«é¢æ¥æ¡ˆå†…ã‚’é€ä¿¡`, 'sms');
                    
                    updateStep(3);
                    updateStats();
                    updateApplicantsList();
                    
                    // QRã‚³ãƒ¼ãƒ‰è¡¨ç¤º
                    document.getElementById('qr-section').classList.remove('hidden');
                    generateQRCode();
                    addLog('é¢æ¥ç”¨QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆå®Œäº†', 'success');
                    
                    // é¢æ¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤ºæº–å‚™
                    setTimeout(() => {
                        document.getElementById('phone-section').style.display = 'none';
                        document.getElementById('interview-section').classList.remove('hidden');
                        updateStep(4);
                        addLog('AIé¢æ¥ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ã€å¿œå‹Ÿè€…ã®æ¥ç¶šå¾…ã¡', 'interview');
                    }, 3000);
                }
            }, 2000);
        }

        // é¢æ¥å›ç­”é€ä¿¡
        function submitAnswer() {
            const answer = document.getElementById('interview-answer').value.trim();
            if (!answer) {
                alert('å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // å¿œå‹Ÿè€…ã®é¢æ¥é–‹å§‹ãƒ•ãƒ©ã‚°
            if (!currentApplicant.interview_started) {
                currentApplicant.interview_started = true;
                addLog(`é¢æ¥é–‹å§‹: ${currentApplicant.name} ãŒè³ªå•ã¸ã®å›ç­”ã‚’é–‹å§‹`, 'interview');
            }
            
            // å›ç­”ã‚’ä¿å­˜
            interviewResponses.push({
                question: questions[currentQuestionIndex],
                answer: answer,
                timestamp: new Date().toISOString()
            });
            
            currentApplicant.interview_responses = [...interviewResponses];
            
            addLog(`è³ªå•${currentQuestionIndex + 1}ã®å›ç­”ã‚’å—ä¿¡: "${answer.substring(0, 30)}${answer.length > 30 ? '...' : ''}"`, 'interview');
            
            document.getElementById('interview-answer').value = '';
            document.getElementById('answered-count').textContent = interviewResponses.length;
            
            currentQuestionIndex++;
            
            if (currentQuestionIndex < questions.length) {
                // æ¬¡ã®è³ªå•ã¸
                document.getElementById('question-number').textContent = currentQuestionIndex + 1;
                document.getElementById('current-question').textContent = questions[currentQuestionIndex];
                document.getElementById('interview-progress-bar').style.width = ((currentQuestionIndex + 1) / questions.length * 100) + '%';
                
                if (currentQuestionIndex === questions.length - 1) {
                    document.getElementById('submit-btn-text').textContent = 'é¢æ¥ã‚’å®Œäº†';
                }
                
                updateStats();
                updateApplicantsList();
            } else {
                // é¢æ¥å®Œäº†
                currentApplicant.interview_completed = true;
                currentApplicant.interview_completed_at = new Date().toISOString();
                
                addLog(`é¢æ¥å®Œäº†: ${currentApplicant.name} ãŒã™ã¹ã¦ã®è³ªå•ã«å›ç­”å®Œäº†`, 'success');
                
                document.getElementById('interview-section').classList.add('hidden');
                document.getElementById('interview-completed').classList.remove('hidden');
                document.getElementById('final-applicant-id').textContent = currentApplicant.id;
                
                updateStep(5);
                updateStats();
                updateApplicantsList();
                
                addLog('æ¡ç”¨å¯©æŸ»ã«å¿…è¦ãªæƒ…å ±åé›†ãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
            }
        }

        // ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒªã‚»ãƒƒãƒˆ
        function resetWorkflow() {
            // çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ
            currentStep = 1;
            currentApplicant = null;
            currentQuestionIndex = 0;
            interviewResponses = [];
            
            // UI ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('phone-form').style.display = 'block';
            document.getElementById('phone-progress').classList.add('hidden');
            document.getElementById('interview-section').classList.add('hidden');
            document.getElementById('interview-completed').classList.add('hidden');
            document.getElementById('phone-section').style.display = 'block';
            document.getElementById('qr-section').classList.add('hidden');
            
            // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('applicant-name').value = 'ç”°ä¸­èŠ±å­';
            document.getElementById('applicant-phone').value = '080-5678-9012';
            document.getElementById('question-number').textContent = '1';
            document.getElementById('current-question').textContent = questions[0];
            document.getElementById('interview-progress-bar').style.width = '20%';
            document.getElementById('answered-count').textContent = '0';
            document.getElementById('submit-btn-text').textContent = 'å›ç­”ã‚’é€ä¿¡';
            
            updateStep(1);
            addLog('ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚æ–°ã—ã„ãƒ‡ãƒ¢ã‚’é–‹å§‹ã§ãã¾ã™', 'info');
        }

        // URL ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆãƒ¢ãƒã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ç”¨ï¼‰
        function checkMobileAccess() {
            const urlParams = new URLSearchParams(window.location.search);
            const mode = urlParams.get('mode');
            const applicantId = urlParams.get('id');
            
            if (mode === 'mobile' && applicantId) {
                // ãƒ¢ãƒã‚¤ãƒ«é¢æ¥ãƒ¢ãƒ¼ãƒ‰ã§ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚ŒãŸå ´åˆã®å‡¦ç†
                addLog(`ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹: ${applicantId}`, 'interview');
                
                // è©²å½“ã™ã‚‹å¿œå‹Ÿè€…ã‚’æ¢ã™
                const applicant = applicants.find(a => a.id === applicantId);
                if (applicant) {
                    currentApplicant = applicant;
                    if (!applicant.interview_started) {
                        // é¢æ¥ã‚’è‡ªå‹•é–‹å§‹
                        document.getElementById('phone-section').style.display = 'none';
                        document.getElementById('interview-section').classList.remove('hidden');
                        updateStep(4);
                    }
                }
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateStep(1);
            updateStats();
            updateApplicantsList();
            addLog('ALSOKæ¡ç”¨ãƒ‡ãƒ¢ã‚·ã‚¹ãƒ†ãƒ ãŒèµ·å‹•ã—ã¾ã—ãŸ', 'success');
            checkMobileAccess();
        });

        // å®šæœŸçš„ãªæ›´æ–°ï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰
        setInterval(() => {
            updateStats();
            updateApplicantsList();
        }, 5000);
    </script>
</body>
</html>