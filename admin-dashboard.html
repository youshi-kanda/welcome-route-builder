<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALSOKæ¡ç”¨ã‚·ã‚¹ãƒ†ãƒ  - ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
        }
        
        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-left: 4px solid #3b82f6;
        }
        
        .log-info { @apply bg-blue-50 border-l-blue-400 text-blue-700; }
        .log-success { @apply bg-green-50 border-l-green-400 text-green-700; }
        .log-interview { @apply bg-orange-50 border-l-orange-400 text-orange-700; }
        .log-warning { @apply bg-yellow-50 border-l-yellow-400 text-yellow-700; }
        .log-error { @apply bg-red-50 border-l-red-400 text-red-700; }
        
        .applicant-registered { @apply bg-blue-50 border-l-blue-400; }
        .applicant-interview-started { @apply bg-orange-50 border-l-orange-400; }
        .applicant-interview-completed { @apply bg-green-50 border-l-green-400; }
        
        @keyframes pulse-gentle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .pulse-gentle {
            animation: pulse-gentle 2s infinite;
        }
        
        .qr-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 240px;
        }
        
        /* ã‚¿ãƒ–ã‚¹ã‚¿ã‚¤ãƒ« */
        .tab-button {
            border-bottom-color: transparent;
            color: #6b7280;
        }
        
        .tab-button:hover {
            color: #374151;
            border-bottom-color: #d1d5db;
        }
        
        .tab-button.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* ãƒ‡ãƒ¼ã‚¿ç®¡ç†å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .csv-preview {
            font-family: 'Courier New', monospace;
            font-size: 11px;
            overflow-x: auto;
            white-space: nowrap;
        }
        
        .csv-preview table {
            border-collapse: collapse;
            width: 100%;
        }
        
        .csv-preview th,
        .csv-preview td {
            border: 1px solid #d1d5db;
            padding: 4px 8px;
            text-align: left;
            min-width: 80px;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .csv-preview th {
            background-color: #f3f4f6;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .csv-preview .status-completed {
            background-color: #dcfce7;
            color: #166534;
        }
        
        .csv-preview .legal-qualified {
            background-color: #dcfce7;
            color: #166534;
        }
        
        .csv-preview .legal-warning {
            background-color: #fef3c7;
            color: #92400e;
        }
    </style>
</head>
<body class="bg-gray-50">
    
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="gradient-bg shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <h1 class="text-2xl font-bold text-white">ğŸ›¡ï¸ ALSOKæ¡ç”¨ã‚·ã‚¹ãƒ†ãƒ </h1>
                    <div class="text-blue-200 text-sm">ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-blue-200 text-sm" id="last-updated">
                        æœ€çµ‚æ›´æ–°: --:--:--
                    </div>
                    <button onclick="refreshData()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg transition-colors">
                        ğŸ”„ æ›´æ–°
                    </button>
                    <button onclick="clearAllData()" class="bg-red-600 hover:bg-red-500 text-white px-4 py-2 rounded-lg transition-colors">
                        ğŸ—‘ï¸ ãƒªã‚»ãƒƒãƒˆ
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div class="bg-white shadow-sm border-b">
        <div class="container mx-auto px-6">
            <nav class="flex space-x-8">
                <button 
                    id="tab-dashboard" 
                    class="tab-button active py-4 px-1 border-b-2 font-medium text-sm focus:outline-none transition-colors"
                    onclick="switchTab('dashboard')"
                >
                    ğŸ“± å¿œå‹Ÿè€…ç®¡ç†
                </button>
                <button 
                    id="tab-data-management" 
                    class="tab-button py-4 px-1 border-b-2 font-medium text-sm focus:outline-none transition-colors"
                    onclick="switchTab('data-management')"
                >
                    ğŸ“Š ãƒ‡ãƒ¼ã‚¿ç®¡ç†
                </button>
                <button 
                    id="tab-statistics" 
                    class="tab-button py-4 px-1 border-b-2 font-medium text-sm focus:outline-none transition-colors"
                    onclick="switchTab('statistics')"
                >
                    ğŸ“ˆ è©³ç´°çµ±è¨ˆ
                </button>
                <button 
                    id="tab-settings" 
                    class="tab-button py-4 px-1 border-b-2 font-medium text-sm focus:outline-none transition-colors"
                    onclick="switchTab('settings')"
                >
                    âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ è¨­å®š
                </button>
            </nav>
        </div>
    </div>

    <div class="container mx-auto px-6 py-8">
        <!-- å¿œå‹Ÿè€…ç®¡ç†ã‚¿ãƒ– -->
        <div id="content-dashboard" class="tab-content active">
            <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
            
            <!-- å·¦ã‚«ãƒ©ãƒ : çµ±è¨ˆã¨QRã‚³ãƒ¼ãƒ‰ -->
            <div class="xl:col-span-1 space-y-8">
                
                <!-- çµ±è¨ˆã‚«ãƒ¼ãƒ‰ -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-6 flex items-center">
                        ğŸ“Š ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµ±è¨ˆ
                    </h3>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="stat-card rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">å¿œå‹Ÿè€…æ•°</p>
                                    <p class="text-2xl font-bold text-blue-600" id="stat-total">0</p>
                                </div>
                                <div class="text-3xl">ğŸ‘¥</div>
                            </div>
                        </div>
                        
                        <div class="stat-card rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">SMSé€ä¿¡</p>
                                    <p class="text-2xl font-bold text-green-600" id="stat-sms">0</p>
                                </div>
                                <div class="text-3xl">ğŸ“±</div>
                            </div>
                        </div>
                        
                        <div class="stat-card rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">é¢æ¥é–‹å§‹</p>
                                    <p class="text-2xl font-bold text-orange-600" id="stat-interview-started">0</p>
                                </div>
                                <div class="text-3xl">ğŸ¤–</div>
                            </div>
                        </div>
                        
                        <div class="stat-card rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">é¢æ¥å®Œäº†</p>
                                    <p class="text-2xl font-bold text-purple-600" id="stat-interview-completed">0</p>
                                </div>
                                <div class="text-3xl">âœ…</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- QRã‚³ãƒ¼ãƒ‰ -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-6 flex items-center">
                        ğŸ“± é¢æ¥ç”¨QRã‚³ãƒ¼ãƒ‰
                        <span id="qr-status" class="ml-2 text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full">
                            ã‚¢ã‚¯ãƒ†ã‚£ãƒ–
                        </span>
                    </h3>
                    
                    <div class="qr-container" id="qr-container">
                        <div class="flex flex-col items-center">
                            <div class="animate-spin w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full mb-2"></div>
                            <p class="text-gray-500 text-sm">QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆä¸­...</p>
                        </div>
                    </div>
                    
                    <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                        <p class="text-xs text-gray-600 break-all">
                            <span class="font-medium">URL:</span>
                            <span id="qr-url">ç”Ÿæˆä¸­...</span>
                        </p>
                    </div>
                    
                    <button onclick="regenerateQR()" class="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors">
                        ğŸ”„ QRã‚³ãƒ¼ãƒ‰å†ç”Ÿæˆ
                    </button>
                </div>
            </div>
            
            <!-- å³ã‚«ãƒ©ãƒ : å¿œå‹Ÿè€…ä¸€è¦§ã¨ãƒ­ã‚° -->
            <div class="xl:col-span-2 space-y-8">
                
                <!-- å¿œå‹Ÿè€…ä¸€è¦§ -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-bold text-gray-800 flex items-center">
                            ğŸ‘¥ å¿œå‹Ÿè€…ä¸€è¦§ 
                            <span id="applicant-count" class="ml-2 text-sm px-2 py-1 bg-blue-100 text-blue-800 rounded-full">
                                0äºº
                            </span>
                        </h3>
                        <div class="flex items-center space-x-4">
                            <div class="text-sm text-gray-600">
                                <span id="active-interviews" class="text-orange-600 font-medium">é¢æ¥ä¸­: 0äºº</span>
                                <span class="mx-2">|</span>
                                <span id="completed-interviews" class="text-green-600 font-medium">å®Œäº†: 0äºº</span>
                            </div>
                            <button 
                                id="export-applicants-csv" 
                                class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm transition-colors"
                                title="å¿œå‹Ÿè€…ãƒ‡ãƒ¼ã‚¿ã‚’CSVå‡ºåŠ›"
                            >
                                ğŸ“Š CSVå‡ºåŠ›
                            </button>
                        </div>
                    </div>
                    
                    <div id="applicants-container" class="space-y-3">
                        <!-- å¿œå‹Ÿè€…ãŒã„ãªã„å ´åˆ -->
                        <div id="no-applicants" class="text-center py-12">
                            <div class="text-6xl mb-4 opacity-50">ğŸ“‹</div>
                            <p class="text-gray-500 text-lg">å¿œå‹Ÿè€…ã¯ã¾ã ã„ã¾ã›ã‚“</p>
                            <p class="text-gray-400 text-sm mt-2">
                                QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦é¢æ¥ã‚’é–‹å§‹ã™ã‚‹ã¨ã€<br>
                                ã“ã“ã«å¿œå‹Ÿè€…æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚° -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-bold text-gray-800">ğŸ“ ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°</h3>
                        <div class="flex items-center space-x-2">
                            <div class="flex items-center">
                                <div class="w-2 h-2 bg-green-400 rounded-full pulse-gentle mr-2"></div>
                                <span class="text-xs text-gray-600">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ </span>
                            </div>
                            <button onclick="clearLogs()" class="text-xs text-gray-500 hover:text-red-600 transition-colors">
                                ãƒ­ã‚°ã‚¯ãƒªã‚¢
                            </button>
                        </div>
                    </div>
                    
                    <div id="system-logs" class="space-y-2 max-h-80 overflow-y-auto">
                        <div class="text-center py-8 text-gray-500">
                            ã‚·ã‚¹ãƒ†ãƒ å¾…æ©Ÿä¸­...
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚¿ãƒ– -->
        <div id="content-data-management" class="tab-content">
            <div class="space-y-8">
                
                <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç†çµ±è¨ˆ -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">äº‹å‰ç¢ºèªå®Œäº†</p>
                                <p class="text-2xl font-bold text-green-600" id="data-stat-completed">0</p>
                            </div>
                            <div class="text-3xl">ğŸ“‹</div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">æ³•çš„é©æ ¼è€…</p>
                                <p class="text-2xl font-bold text-blue-600" id="data-stat-qualified">0</p>
                            </div>
                            <div class="text-3xl">âš–ï¸</div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">å®Œäº†ç‡</p>
                                <p class="text-2xl font-bold text-purple-600" id="data-stat-rate">0%</p>
                            </div>
                            <div class="text-3xl">ğŸ“Š</div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">å¹³å‡æ‰€è¦æ™‚é–“</p>
                                <p class="text-2xl font-bold text-orange-600" id="data-stat-duration">0åˆ†</p>
                            </div>
                            <div class="text-3xl">â±ï¸</div>
                        </div>
                    </div>
                </div>
                
                <!-- CSVå‡ºåŠ›ãƒ»ç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    
                    <!-- CSVå‡ºåŠ›ç®¡ç† -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-6 flex items-center">
                            ğŸ“¥ ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›ç®¡ç†
                        </h3>
                        
                        <div class="space-y-4">
                            <div class="p-4 bg-blue-50 rounded-lg">
                                <h4 class="font-medium text-blue-900 mb-2">ğŸ“Š CSVä¸€æ‹¬å‡ºåŠ›</h4>
                                <p class="text-sm text-blue-700 mb-3">
                                    ã™ã¹ã¦ã®äº‹å‰ç¢ºèªãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆå½¢å¼ã§å‡ºåŠ›
                                </p>
                                <button 
                                    id="export-all-csv" 
                                    class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors"
                                >
                                    ğŸ“¥ å…¨ãƒ‡ãƒ¼ã‚¿CSVå‡ºåŠ›
                                </button>
                            </div>
                            
                            <div class="p-4 bg-green-50 rounded-lg">
                                <h4 class="font-medium text-green-900 mb-2">ğŸ“‘ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†</h4>
                                <p class="text-sm text-green-700 mb-3">
                                    Google Sheetsç”¨ã®ç©ºç™½ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                                </p>
                                <button 
                                    id="download-template-csv" 
                                    class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg transition-colors"
                                >
                                    ğŸ“‘ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                                </button>
                            </div>
                            
                            <div class="p-4 bg-purple-50 rounded-lg">
                                <h4 class="font-medium text-purple-900 mb-2">ğŸ² ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿</h4>
                                <p class="text-sm text-purple-700 mb-3">
                                    ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒ¢ç”¨ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
                                </p>
                                <button 
                                    id="generate-sample-csv" 
                                    class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-lg transition-colors"
                                >
                                    ğŸ² ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å¿œå‹ŸçµŒè·¯åˆ†æ -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-6 flex items-center">
                            ğŸ“ˆ å¿œå‹ŸçµŒè·¯åˆ†æ
                        </h3>
                        
                        <div id="application-sources-chart" class="space-y-3">
                            <!-- å‹•çš„ã«ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
                
                <!-- CSVãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-bold text-gray-800">ğŸ“„ ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
                        <div class="flex space-x-2">
                            <button 
                                id="refresh-csv-preview" 
                                class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors"
                            >
                                ğŸ”„ æ›´æ–°
                            </button>
                            <span id="preview-count" class="text-sm text-gray-600 px-3 py-1">
                                0ä»¶ã®ãƒ‡ãƒ¼ã‚¿
                            </span>
                        </div>
                    </div>
                    
                    <div id="csv-preview-data" class="csv-preview bg-gray-50 rounded-lg p-4 max-h-96 overflow-auto">
                        <!-- CSVãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- è©³ç´°çµ±è¨ˆã‚¿ãƒ– -->
        <div id="content-statistics" class="tab-content">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-6">ğŸ“ˆ è©³ç´°çµ±è¨ˆåˆ†æ</h3>
                <div class="text-center py-12 text-gray-500">
                    <div class="text-4xl mb-4">ğŸ“Š</div>
                    <p>è©³ç´°çµ±è¨ˆæ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™</p>
                </div>
            </div>
        </div>

        <!-- ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã‚¿ãƒ– -->
        <div id="content-settings" class="tab-content">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-6">âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</h3>
                <div class="text-center py-12 text-gray-500">
                    <div class="text-4xl mb-4">âš™ï¸</div>
                    <p>ã‚·ã‚¹ãƒ†ãƒ è¨­å®šæ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™</p>
                </div>
            </div>
        </div>
    </div>

    <!-- å…±æœ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="shared-storage.js"></script>
    <!-- CSVå‡ºåŠ›ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="csv-export.js"></script>
    <!-- ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="sample-data-generator.js"></script>
    
    <script>
        let updateInterval;
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            generateQRCode();
            startAutoUpdate();
        });
        
        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åˆæœŸåŒ–
        function initializeDashboard() {
            // ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            window.alsokStorage.onUpdate(handleDataUpdate);
            
            // åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            updateDashboard();
            
            // å¿œå‹Ÿè€…ãƒªã‚¹ãƒˆCSVå‡ºåŠ›ã‚¤ãƒ™ãƒ³ãƒˆ
            setupApplicantListEvents();
            
            // åˆæœŸãƒ­ã‚°
            window.alsokStorage.addLog('ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•', 'ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒèµ·å‹•ã—ã¾ã—ãŸ', 'info');
        }
        
        // å¿œå‹Ÿè€…ãƒªã‚¹ãƒˆã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
        function setupApplicantListEvents() {
            const exportButton = document.getElementById('export-applicants-csv');
            if (exportButton && !exportButton.hasAttribute('data-event-set')) {
                exportButton.addEventListener('click', function() {
                    if (window.alsokCSVExporter) {
                        const success = window.alsokCSVExporter.exportAllApplicants();
                        if (success) {
                            const originalText = this.textContent;
                            this.textContent = 'âœ… å®Œäº†ï¼';
                            this.disabled = true;
                            
                            setTimeout(() => {
                                this.textContent = originalText;
                                this.disabled = false;
                            }, 2000);
                        }
                    }
                });
                exportButton.setAttribute('data-event-set', 'true');
            }
        }
        
        // ãƒ‡ãƒ¼ã‚¿æ›´æ–°ãƒãƒ³ãƒ‰ãƒ©
        function handleDataUpdate(event) {
            updateDashboard();
        }
        
        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–°
        function updateDashboard() {
            updateStats();
            updateApplicantsList();
            updateSystemLogs();
            updateLastUpdated();
        }
        
        // çµ±è¨ˆæ›´æ–°
        function updateStats() {
            const stats = window.alsokStorage.getStats();
            
            document.getElementById('stat-total').textContent = stats.totalApplicants;
            document.getElementById('stat-sms').textContent = stats.smsSent;
            document.getElementById('stat-interview-started').textContent = stats.interviewsStarted;
            document.getElementById('stat-interview-completed').textContent = stats.interviewsCompleted;
            
            // å¿œå‹Ÿè€…ã‚«ã‚¦ãƒ³ãƒˆæ›´æ–°
            document.getElementById('applicant-count').textContent = `${stats.totalApplicants}äºº`;
            document.getElementById('active-interviews').textContent = `é¢æ¥ä¸­: ${stats.interviewsStarted - stats.interviewsCompleted}äºº`;
            document.getElementById('completed-interviews').textContent = `å®Œäº†: ${stats.interviewsCompleted}äºº`;
        }
        
        // å¿œå‹Ÿè€…ä¸€è¦§æ›´æ–°
        function updateApplicantsList() {
            const applicants = window.alsokStorage.getAllApplicants();
            const container = document.getElementById('applicants-container');
            const noApplicants = document.getElementById('no-applicants');
            
            if (applicants.length === 0) {
                noApplicants.classList.remove('hidden');
                container.innerHTML = '';
                container.appendChild(noApplicants);
                return;
            }
            
            noApplicants.classList.add('hidden');
            
            container.innerHTML = applicants.map(applicant => {
                const statusInfo = getStatusInfo(applicant.status);
                const progressInfo = getProgressInfo(applicant);
                
                return `
                    <div class="applicant-${applicant.status} border-l-4 rounded-lg p-4 bg-white border">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-2">
                                    <h4 class="font-semibold text-gray-800">${applicant.name}</h4>
                                    <span class="px-2 py-1 text-xs rounded-full ${statusInfo.class}">
                                        ${statusInfo.text}
                                    </span>
                                </div>
                                
                                <div class="text-sm text-gray-600 space-y-1">
                                    <p>ğŸ“± ${applicant.phone}</p>
                                    <p>ğŸ†” ${applicant.id}</p>
                                    <p>â° ç™»éŒ²: ${formatDateTime(applicant.createdAt)}</p>
                                    ${applicant.interviewStartedAt ? `<p>ğŸ¤– é¢æ¥é–‹å§‹: ${formatDateTime(applicant.interviewStartedAt)}</p>` : ''}
                                    ${applicant.interviewCompletedAt ? `<p>âœ… é¢æ¥å®Œäº†: ${formatDateTime(applicant.interviewCompletedAt)}</p>` : ''}
                                </div>
                            </div>
                            
                            <div class="text-right ml-4">
                                <div class="text-sm text-gray-600 mb-2">
                                    ${progressInfo}
                                </div>
                                <div class="space-y-1">
                                    ${applicant.responses.length > 0 ? `
                                        <button onclick="showApplicantDetails('${applicant.id}')" 
                                                class="block text-xs text-blue-600 hover:text-blue-800 transition-colors">
                                            å›ç­”è©³ç´°ã‚’è¦‹ã‚‹
                                        </button>
                                    ` : ''}
                                    ${applicant.screeningResponses && applicant.screeningResponses.length > 0 ? `
                                        <button onclick="exportApplicantCSV('${applicant.id}')" 
                                                class="block text-xs text-green-600 hover:text-green-800 transition-colors">
                                            ğŸ“Š CSVå‡ºåŠ›
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æƒ…å ±å–å¾—
        function getStatusInfo(status) {
            switch (status) {
                case 'registered':
                    return { text: 'ç™»éŒ²æ¸ˆã¿', class: 'bg-blue-100 text-blue-800' };
                case 'interview_started':
                    return { text: 'é¢æ¥ä¸­', class: 'bg-orange-100 text-orange-800' };
                case 'interview_completed':
                    return { text: 'é¢æ¥å®Œäº†', class: 'bg-green-100 text-green-800' };
                default:
                    return { text: 'ä¸æ˜', class: 'bg-gray-100 text-gray-800' };
            }
        }
        
        // é€²è¡Œæƒ…å ±å–å¾—
        function getProgressInfo(applicant) {
            if (applicant.status === 'registered') {
                return 'é¢æ¥å¾…ã¡';
            } else if (applicant.status === 'interview_started') {
                return `${applicant.responses.length}/5 å•å›ç­”æ¸ˆã¿`;
            } else if (applicant.status === 'interview_completed') {
                return `å…¨${applicant.responses.length}å•å®Œäº†`;
            }
            return '';
        }
        
        // ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°æ›´æ–°
        function updateSystemLogs() {
            const logs = window.alsokStorage.getSystemLogs(15);
            const container = document.getElementById('system-logs');
            
            if (logs.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500">ãƒ­ã‚°ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            container.innerHTML = logs.map(log => `
                <div class="log-${log.category} border-l-4 p-3 rounded-r text-sm">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <span class="font-medium">${log.type}</span>
                            <span class="ml-2">${log.message}</span>
                        </div>
                        <div class="text-xs opacity-75 ml-4">
                            ${formatTime(log.timestamp)}
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
        function generateQRCode() {
            const mobileUrl = `${window.location.origin}/mobile`;
            document.getElementById('qr-url').textContent = mobileUrl;
            
            const container = document.getElementById('qr-container');
            container.innerHTML = '<canvas id="qr-canvas"></canvas>';
            
            QRCode.toCanvas(document.getElementById('qr-canvas'), mobileUrl, {
                width: 200,
                height: 200,
                margin: 2,
                color: {
                    dark: '#1e40af',
                    light: '#ffffff'
                }
            }, function (error) {
                if (error) {
                    console.error('QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                    container.innerHTML = `
                        <div class="text-center text-red-600">
                            <div class="text-4xl mb-2">âš ï¸</div>
                            <p class="text-sm">QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ</p>
                        </div>
                    `;
                } else {
                    window.alsokStorage.addLog('QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ', 'é¢æ¥ç”¨QRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã—ãŸ', 'success');
                }
            });
        }
        
        // æœ€çµ‚æ›´æ–°æ™‚åˆ»æ›´æ–°
        function updateLastUpdated() {
            const now = new Date();
            document.getElementById('last-updated').textContent = 
                `æœ€çµ‚æ›´æ–°: ${now.toLocaleTimeString('ja-JP')}`;
        }
        
        // è‡ªå‹•æ›´æ–°é–‹å§‹
        function startAutoUpdate() {
            updateInterval = setInterval(() => {
                window.alsokStorage.updateStats();
                updateLastUpdated();
            }, 5000);
        }
        
        // æ—¥æ™‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatDateTime(dateString) {
            return new Date(dateString).toLocaleString('ja-JP', {
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        function formatTime(dateString) {
            return new Date(dateString).toLocaleTimeString('ja-JP', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
        function refreshData() {
            window.alsokStorage.updateStats();
            updateDashboard();
            window.alsokStorage.addLog('æ‰‹å‹•æ›´æ–°', 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’æ‰‹å‹•ã§æ›´æ–°ã—ã¾ã—ãŸ', 'info');
        }
        
        function regenerateQR() {
            generateQRCode();
        }
        
        function clearAllData() {
            if (confirm('ã™ã¹ã¦ã®ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                window.alsokStorage.clearAll();
                updateDashboard();
            }
        }
        
        function clearLogs() {
            if (confirm('ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                const data = window.alsokStorage.getData();
                data.systemLogs = [];
                window.alsokStorage.saveData(data);
                window.alsokStorage.addLog('ãƒ­ã‚°ã‚¯ãƒªã‚¢', 'ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'warning');
            }
        }
        
        function showApplicantDetails(applicantId) {
            const applicant = window.alsokStorage.getApplicant(applicantId);
            if (!applicant) return;
            
            const responses = applicant.responses.map((r, i) => 
                `Q${i+1}: ${r.question}\\nA${i+1}: ${r.answer}\\n`
            ).join('\\n');
            
            alert(`å¿œå‹Ÿè€…è©³ç´° - ${applicant.name}\\n\\n${responses}`);
        }
        
        // å€‹åˆ¥å¿œå‹Ÿè€…CSVå‡ºåŠ›
        function exportApplicantCSV(applicantId) {
            if (window.alsokCSVExporter) {
                const success = window.alsokCSVExporter.exportSingleApplicant(applicantId);
                if (success) {
                    // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’çŸ­æ™‚é–“è¡¨ç¤º
                    const applicant = window.alsokStorage.getApplicant(applicantId);
                    window.alsokStorage.addLog('CSVå‡ºåŠ›', `${applicant.name}ã®ãƒ‡ãƒ¼ã‚¿ã‚’CSVå‡ºåŠ›ã—ã¾ã—ãŸ`, 'success');
                }
            }
        }
        
        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
        function switchTab(tabName) {
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
            document.getElementById(`tab-${tabName}`).classList.add('active');
            document.getElementById(`content-${tabName}`).classList.add('active');
            
            // ã‚¿ãƒ–å›ºæœ‰ã®åˆæœŸåŒ–
            if (tabName === 'data-management') {
                initializeDataManagement();
            }
        }
        
        // ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚¿ãƒ–åˆæœŸåŒ–
        function initializeDataManagement() {
            updateDataManagementStats();
            updateApplicationSourcesChart();
            updateCSVPreview();
            setupDataManagementEvents();
        }
        
        // ãƒ‡ãƒ¼ã‚¿ç®¡ç†çµ±è¨ˆæ›´æ–°
        function updateDataManagementStats() {
            const applicants = window.alsokStorage.getAllApplicants();
            const completedApplicants = applicants.filter(a => 
                a.screeningResponses && a.screeningResponses.length > 0
            );
            const qualifiedApplicants = completedApplicants.filter(a => a.isQualified);
            
            // å®Œäº†ç‡è¨ˆç®—
            const completionRate = applicants.length > 0 ? 
                Math.round((completedApplicants.length / applicants.length) * 100) : 0;
            
            // å¹³å‡æ‰€è¦æ™‚é–“è¨ˆç®—
            let avgDuration = 0;
            if (completedApplicants.length > 0) {
                const totalDuration = completedApplicants.reduce((sum, a) => {
                    if (a.screeningStartedAt && a.screeningCompletedAt) {
                        const start = new Date(a.screeningStartedAt);
                        const end = new Date(a.screeningCompletedAt);
                        return sum + Math.ceil((end - start) / (1000 * 60));
                    }
                    return sum;
                }, 0);
                avgDuration = Math.round(totalDuration / completedApplicants.length);
            }
            
            // çµ±è¨ˆè¡¨ç¤ºæ›´æ–°
            document.getElementById('data-stat-completed').textContent = completedApplicants.length;
            document.getElementById('data-stat-qualified').textContent = qualifiedApplicants.length;
            document.getElementById('data-stat-rate').textContent = `${completionRate}%`;
            document.getElementById('data-stat-duration').textContent = `${avgDuration}åˆ†`;
        }
        
        // å¿œå‹ŸçµŒè·¯ãƒãƒ£ãƒ¼ãƒˆæ›´æ–°
        function updateApplicationSourcesChart() {
            const applicants = window.alsokStorage.getAllApplicants();
            const completedApplicants = applicants.filter(a => 
                a.screeningResponses && a.screeningResponses.length > 0
            );
            
            const sourceMapping = {
                1: 'ãŠé›»è©±ã§ã®ãŠå•ã„åˆã‚ã›',
                2: 'Indeedï¼ˆã‚¤ãƒ³ãƒ‡ã‚£ãƒ¼ãƒ‰ï¼‰',
                3: 'ãƒãƒ­ãƒ¼ãƒ¯ãƒ¼ã‚¯',
                4: 'å¼Šç¤¾ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸',
                5: 'SNSï¼ˆInstagramã€Twitterç­‰ï¼‰',
                6: 'æ±‚äººèªŒãƒ»ãƒ•ãƒªãƒ¼ãƒšãƒ¼ãƒ‘ãƒ¼',
                7: 'çŸ¥äººã‹ã‚‰ã®ç´¹ä»‹',
                8: 'ãã®ä»–'
            };
            
            const sourceCounts = {};
            completedApplicants.forEach(applicant => {
                const source = sourceMapping[applicant.applicationSource] || 'ãã®ä»–';
                sourceCounts[source] = (sourceCounts[source] || 0) + 1;
            });
            
            const container = document.getElementById('application-sources-chart');
            
            if (Object.keys(sourceCounts).length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-4">ğŸ“Š</div>
                        <p>å¿œå‹Ÿãƒ‡ãƒ¼ã‚¿ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</p>
                    </div>
                `;
                return;
            }
            
            const total = Object.values(sourceCounts).reduce((sum, count) => sum + count, 0);
            
            container.innerHTML = Object.entries(sourceCounts).map(([source, count]) => {
                const percentage = Math.round((count / total) * 100);
                return `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex-1">
                            <div class="text-sm font-medium text-gray-800">${source}</div>
                            <div class="text-xs text-gray-600">${count}ä»¶ (${percentage}%)</div>
                        </div>
                        <div class="w-24 bg-gray-200 rounded-full h-2 ml-4">
                            <div class="bg-blue-600 h-2 rounded-full" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // CSVãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
        function updateCSVPreview() {
            const applicants = window.alsokStorage.getAllApplicants();
            const completedApplicants = applicants.filter(a => 
                a.screeningResponses && a.screeningResponses.length > 0
            );
            
            const container = document.getElementById('csv-preview-data');
            const countElement = document.getElementById('preview-count');
            
            countElement.textContent = `${completedApplicants.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿`;
            
            if (completedApplicants.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-4">ğŸ“‹</div>
                        <div>äº‹å‰ç¢ºèªã‚’å®Œäº†ã—ãŸå¿œå‹Ÿè€…ãŒã„ã¾ã›ã‚“</div>
                        <button onclick="generateSampleDataForManagement()" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded-lg">
                            ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
                        </button>
                    </div>
                `;
                return;
            }
            
            // CSVãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆæœ€åˆã®3è¡Œã®ã¿ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰
            const previewApplicants = completedApplicants.slice(0, 3);
            const csvRows = [];
            const headers = window.alsokCSVExporter.csvHeaders;
            csvRows.push(headers);
            
            previewApplicants.forEach(applicant => {
                csvRows.push(window.alsokCSVExporter.convertApplicantToCSVRow(applicant));
            });
            
            // ãƒ†ãƒ¼ãƒ–ãƒ«ç”Ÿæˆ
            const tableHTML = `
                <table>
                    <thead>
                        <tr>${headers.slice(0, 8).map(header => `<th>${header}</th>`).join('')}</tr>
                    </thead>
                    <tbody>
                        ${csvRows.slice(1).map(row => `
                            <tr>
                                ${row.slice(0, 8).map((cell, index) => {
                                    let classes = '';
                                    if (headers[index] === 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹' && cell === 'äº‹å‰ç¢ºèªå®Œäº†') {
                                        classes = 'status-completed';
                                    }
                                    if (headers[index] === 'æ³•çš„é©æ ¼æ€§') {
                                        if (cell === 'é©æ ¼') {
                                            classes = 'legal-qualified';
                                        } else if (cell && cell.includes('è¦æ³¨æ„')) {
                                            classes = 'legal-warning';
                                        }
                                    }
                                    return `<td class="${classes}" title="${cell}">${cell || '-'}</td>`;
                                }).join('')}
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                ${completedApplicants.length > 3 ? `
                    <div class="text-center mt-4 text-sm text-gray-600">
                        ... ä»– ${completedApplicants.length - 3} ä»¶ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã™
                    </div>
                ` : ''}
            `;
            
            container.innerHTML = tableHTML;
        }
        
        // ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
        function setupDataManagementEvents() {
            // ä¸€åº¦ã ã‘è¨­å®šã•ã‚Œã‚‹ã‚ˆã†ã«ç¢ºèª
            if (document.getElementById('export-all-csv').hasAttribute('data-event-set')) {
                return;
            }
            
            // CSVå‡ºåŠ›
            document.getElementById('export-all-csv').addEventListener('click', function() {
                if (window.alsokCSVExporter) {
                    const success = window.alsokCSVExporter.exportAllApplicants();
                    if (success) {
                        showDataActionFeedback(this, 'âœ… ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å®Œäº†ï¼');
                    }
                }
            });
            
            // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            document.getElementById('download-template-csv').addEventListener('click', function() {
                downloadCSVTemplate();
                showDataActionFeedback(this, 'âœ… ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å®Œäº†ï¼');
            });
            
            // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
            document.getElementById('generate-sample-csv').addEventListener('click', function() {
                generateSampleDataForManagement();
                showDataActionFeedback(this, 'âœ… ç”Ÿæˆå®Œäº†ï¼');
            });
            
            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
            document.getElementById('refresh-csv-preview').addEventListener('click', function() {
                updateCSVPreview();
                updateDataManagementStats();
                updateApplicationSourcesChart();
                showDataActionFeedback(this, 'âœ… æ›´æ–°å®Œäº†ï¼');
            });
            
            // ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®šæ¸ˆã¿ãƒãƒ¼ã‚¯
            document.getElementById('export-all-csv').setAttribute('data-event-set', 'true');
        }
        
        // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¡¨ç¤º
        function showDataActionFeedback(button, message) {
            const originalText = button.textContent;
            button.textContent = message;
            button.disabled = true;
            
            setTimeout(() => {
                button.textContent = originalText;
                button.disabled = false;
            }, 2000);
        }
        
        // CSVãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        function downloadCSVTemplate() {
            const headers = window.alsokCSVExporter.csvHeaders;
            const templateContent = headers.join(',') + '\r\n';
            
            const bom = '\uFEFF';
            const blob = new Blob([bom + templateContent], { 
                type: 'text/csv;charset=utf-8;' 
            });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', 'ALSOKæ¡ç”¨ç®¡ç†ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ.csv');
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            URL.revokeObjectURL(url);
        }
        
        // ç®¡ç†ç”»é¢ç”¨ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        function generateSampleDataForManagement() {
            if (window.alsokSampleGenerator) {
                window.alsokSampleGenerator.addSampleDataToStorage(5);
                
                // UIæ›´æ–°
                setTimeout(() => {
                    updateDataManagementStats();
                    updateApplicationSourcesChart();
                    updateCSVPreview();
                    updateDashboard(); // ãƒ¡ã‚¤ãƒ³çµ±è¨ˆã‚‚æ›´æ–°
                }, 500);
            }
        }
        
        // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        window.addEventListener('beforeunload', function() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        });
    </script>
</body>
</html>