<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALSOKæ¡ç”¨ã‚·ã‚¹ãƒ†ãƒ  - ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
        }
        
        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-left: 4px solid #3b82f6;
        }
        
        .log-info { @apply bg-blue-50 border-l-blue-400 text-blue-700; }
        .log-success { @apply bg-green-50 border-l-green-400 text-green-700; }
        .log-interview { @apply bg-orange-50 border-l-orange-400 text-orange-700; }
        .log-warning { @apply bg-yellow-50 border-l-yellow-400 text-yellow-700; }
        .log-error { @apply bg-red-50 border-l-red-400 text-red-700; }
        
        .applicant-registered { @apply bg-blue-50 border-l-blue-400; }
        .applicant-interview-started { @apply bg-orange-50 border-l-orange-400; }
        .applicant-interview-completed { @apply bg-green-50 border-l-green-400; }
        
        @keyframes pulse-gentle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .pulse-gentle {
            animation: pulse-gentle 2s infinite;
        }
        
        .qr-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 240px;
        }
    </style>
</head>
<body class="bg-gray-50">
    
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="gradient-bg shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <h1 class="text-2xl font-bold text-white">ğŸ›¡ï¸ ALSOKæ¡ç”¨ã‚·ã‚¹ãƒ†ãƒ </h1>
                    <div class="text-blue-200 text-sm">ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-blue-200 text-sm" id="last-updated">
                        æœ€çµ‚æ›´æ–°: --:--:--
                    </div>
                    <button onclick="refreshData()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg transition-colors">
                        ğŸ”„ æ›´æ–°
                    </button>
                    <button onclick="clearAllData()" class="bg-red-600 hover:bg-red-500 text-white px-4 py-2 rounded-lg transition-colors">
                        ğŸ—‘ï¸ ãƒªã‚»ãƒƒãƒˆ
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-6 py-8">
        <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
            
            <!-- å·¦ã‚«ãƒ©ãƒ : çµ±è¨ˆã¨QRã‚³ãƒ¼ãƒ‰ -->
            <div class="xl:col-span-1 space-y-8">
                
                <!-- çµ±è¨ˆã‚«ãƒ¼ãƒ‰ -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-6 flex items-center">
                        ğŸ“Š ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµ±è¨ˆ
                    </h3>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="stat-card rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">å¿œå‹Ÿè€…æ•°</p>
                                    <p class="text-2xl font-bold text-blue-600" id="stat-total">0</p>
                                </div>
                                <div class="text-3xl">ğŸ‘¥</div>
                            </div>
                        </div>
                        
                        <div class="stat-card rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">SMSé€ä¿¡</p>
                                    <p class="text-2xl font-bold text-green-600" id="stat-sms">0</p>
                                </div>
                                <div class="text-3xl">ğŸ“±</div>
                            </div>
                        </div>
                        
                        <div class="stat-card rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">é¢æ¥é–‹å§‹</p>
                                    <p class="text-2xl font-bold text-orange-600" id="stat-interview-started">0</p>
                                </div>
                                <div class="text-3xl">ğŸ¤–</div>
                            </div>
                        </div>
                        
                        <div class="stat-card rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">é¢æ¥å®Œäº†</p>
                                    <p class="text-2xl font-bold text-purple-600" id="stat-interview-completed">0</p>
                                </div>
                                <div class="text-3xl">âœ…</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- QRã‚³ãƒ¼ãƒ‰ -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-6 flex items-center">
                        ğŸ“± é¢æ¥ç”¨QRã‚³ãƒ¼ãƒ‰
                        <span id="qr-status" class="ml-2 text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full">
                            ã‚¢ã‚¯ãƒ†ã‚£ãƒ–
                        </span>
                    </h3>
                    
                    <div class="qr-container" id="qr-container">
                        <div class="flex flex-col items-center">
                            <div class="animate-spin w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full mb-2"></div>
                            <p class="text-gray-500 text-sm">QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆä¸­...</p>
                        </div>
                    </div>
                    
                    <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                        <p class="text-xs text-gray-600 break-all">
                            <span class="font-medium">URL:</span>
                            <span id="qr-url">ç”Ÿæˆä¸­...</span>
                        </p>
                    </div>
                    
                    <button onclick="regenerateQR()" class="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors">
                        ğŸ”„ QRã‚³ãƒ¼ãƒ‰å†ç”Ÿæˆ
                    </button>
                </div>
            </div>
            
            <!-- å³ã‚«ãƒ©ãƒ : å¿œå‹Ÿè€…ä¸€è¦§ã¨ãƒ­ã‚° -->
            <div class="xl:col-span-2 space-y-8">
                
                <!-- å¿œå‹Ÿè€…ä¸€è¦§ -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-bold text-gray-800 flex items-center">
                            ğŸ‘¥ å¿œå‹Ÿè€…ä¸€è¦§ 
                            <span id="applicant-count" class="ml-2 text-sm px-2 py-1 bg-blue-100 text-blue-800 rounded-full">
                                0äºº
                            </span>
                        </h3>
                        <div class="text-sm text-gray-600">
                            <span id="active-interviews" class="text-orange-600 font-medium">é¢æ¥ä¸­: 0äºº</span>
                            <span class="mx-2">|</span>
                            <span id="completed-interviews" class="text-green-600 font-medium">å®Œäº†: 0äºº</span>
                        </div>
                    </div>
                    
                    <div id="applicants-container" class="space-y-3">
                        <!-- å¿œå‹Ÿè€…ãŒã„ãªã„å ´åˆ -->
                        <div id="no-applicants" class="text-center py-12">
                            <div class="text-6xl mb-4 opacity-50">ğŸ“‹</div>
                            <p class="text-gray-500 text-lg">å¿œå‹Ÿè€…ã¯ã¾ã ã„ã¾ã›ã‚“</p>
                            <p class="text-gray-400 text-sm mt-2">
                                QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦é¢æ¥ã‚’é–‹å§‹ã™ã‚‹ã¨ã€<br>
                                ã“ã“ã«å¿œå‹Ÿè€…æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚° -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-bold text-gray-800">ğŸ“ ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°</h3>
                        <div class="flex items-center space-x-2">
                            <div class="flex items-center">
                                <div class="w-2 h-2 bg-green-400 rounded-full pulse-gentle mr-2"></div>
                                <span class="text-xs text-gray-600">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ </span>
                            </div>
                            <button onclick="clearLogs()" class="text-xs text-gray-500 hover:text-red-600 transition-colors">
                                ãƒ­ã‚°ã‚¯ãƒªã‚¢
                            </button>
                        </div>
                    </div>
                    
                    <div id="system-logs" class="space-y-2 max-h-80 overflow-y-auto">
                        <div class="text-center py-8 text-gray-500">
                            ã‚·ã‚¹ãƒ†ãƒ å¾…æ©Ÿä¸­...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å…±æœ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="shared-storage.js"></script>
    
    <script>
        let updateInterval;
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            generateQRCode();
            startAutoUpdate();
        });
        
        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åˆæœŸåŒ–
        function initializeDashboard() {
            // ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            window.alsokStorage.onUpdate(handleDataUpdate);
            
            // åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            updateDashboard();
            
            // åˆæœŸãƒ­ã‚°
            window.alsokStorage.addLog('ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•', 'ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒèµ·å‹•ã—ã¾ã—ãŸ', 'info');
        }
        
        // ãƒ‡ãƒ¼ã‚¿æ›´æ–°ãƒãƒ³ãƒ‰ãƒ©
        function handleDataUpdate(event) {
            updateDashboard();
        }
        
        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–°
        function updateDashboard() {
            updateStats();
            updateApplicantsList();
            updateSystemLogs();
            updateLastUpdated();
        }
        
        // çµ±è¨ˆæ›´æ–°
        function updateStats() {
            const stats = window.alsokStorage.getStats();
            
            document.getElementById('stat-total').textContent = stats.totalApplicants;
            document.getElementById('stat-sms').textContent = stats.smsSent;
            document.getElementById('stat-interview-started').textContent = stats.interviewsStarted;
            document.getElementById('stat-interview-completed').textContent = stats.interviewsCompleted;
            
            // å¿œå‹Ÿè€…ã‚«ã‚¦ãƒ³ãƒˆæ›´æ–°
            document.getElementById('applicant-count').textContent = `${stats.totalApplicants}äºº`;
            document.getElementById('active-interviews').textContent = `é¢æ¥ä¸­: ${stats.interviewsStarted - stats.interviewsCompleted}äºº`;
            document.getElementById('completed-interviews').textContent = `å®Œäº†: ${stats.interviewsCompleted}äºº`;
        }
        
        // å¿œå‹Ÿè€…ä¸€è¦§æ›´æ–°
        function updateApplicantsList() {
            const applicants = window.alsokStorage.getAllApplicants();
            const container = document.getElementById('applicants-container');
            const noApplicants = document.getElementById('no-applicants');
            
            if (applicants.length === 0) {
                noApplicants.classList.remove('hidden');
                container.innerHTML = '';
                container.appendChild(noApplicants);
                return;
            }
            
            noApplicants.classList.add('hidden');
            
            container.innerHTML = applicants.map(applicant => {
                const statusInfo = getStatusInfo(applicant.status);
                const progressInfo = getProgressInfo(applicant);
                
                return `
                    <div class="applicant-${applicant.status} border-l-4 rounded-lg p-4 bg-white border">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-2">
                                    <h4 class="font-semibold text-gray-800">${applicant.name}</h4>
                                    <span class="px-2 py-1 text-xs rounded-full ${statusInfo.class}">
                                        ${statusInfo.text}
                                    </span>
                                </div>
                                
                                <div class="text-sm text-gray-600 space-y-1">
                                    <p>ğŸ“± ${applicant.phone}</p>
                                    <p>ğŸ†” ${applicant.id}</p>
                                    <p>â° ç™»éŒ²: ${formatDateTime(applicant.createdAt)}</p>
                                    ${applicant.interviewStartedAt ? `<p>ğŸ¤– é¢æ¥é–‹å§‹: ${formatDateTime(applicant.interviewStartedAt)}</p>` : ''}
                                    ${applicant.interviewCompletedAt ? `<p>âœ… é¢æ¥å®Œäº†: ${formatDateTime(applicant.interviewCompletedAt)}</p>` : ''}
                                </div>
                            </div>
                            
                            <div class="text-right ml-4">
                                <div class="text-sm text-gray-600 mb-2">
                                    ${progressInfo}
                                </div>
                                ${applicant.responses.length > 0 ? `
                                    <button onclick="showApplicantDetails('${applicant.id}')" 
                                            class="text-xs text-blue-600 hover:text-blue-800 transition-colors">
                                        å›ç­”è©³ç´°ã‚’è¦‹ã‚‹
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æƒ…å ±å–å¾—
        function getStatusInfo(status) {
            switch (status) {
                case 'registered':
                    return { text: 'ç™»éŒ²æ¸ˆã¿', class: 'bg-blue-100 text-blue-800' };
                case 'interview_started':
                    return { text: 'é¢æ¥ä¸­', class: 'bg-orange-100 text-orange-800' };
                case 'interview_completed':
                    return { text: 'é¢æ¥å®Œäº†', class: 'bg-green-100 text-green-800' };
                default:
                    return { text: 'ä¸æ˜', class: 'bg-gray-100 text-gray-800' };
            }
        }
        
        // é€²è¡Œæƒ…å ±å–å¾—
        function getProgressInfo(applicant) {
            if (applicant.status === 'registered') {
                return 'é¢æ¥å¾…ã¡';
            } else if (applicant.status === 'interview_started') {
                return `${applicant.responses.length}/5 å•å›ç­”æ¸ˆã¿`;
            } else if (applicant.status === 'interview_completed') {
                return `å…¨${applicant.responses.length}å•å®Œäº†`;
            }
            return '';
        }
        
        // ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°æ›´æ–°
        function updateSystemLogs() {
            const logs = window.alsokStorage.getSystemLogs(15);
            const container = document.getElementById('system-logs');
            
            if (logs.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500">ãƒ­ã‚°ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            container.innerHTML = logs.map(log => `
                <div class="log-${log.category} border-l-4 p-3 rounded-r text-sm">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <span class="font-medium">${log.type}</span>
                            <span class="ml-2">${log.message}</span>
                        </div>
                        <div class="text-xs opacity-75 ml-4">
                            ${formatTime(log.timestamp)}
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
        function generateQRCode() {
            const mobileUrl = `${window.location.origin}/mobile`;
            document.getElementById('qr-url').textContent = mobileUrl;
            
            const container = document.getElementById('qr-container');
            container.innerHTML = '<canvas id="qr-canvas"></canvas>';
            
            QRCode.toCanvas(document.getElementById('qr-canvas'), mobileUrl, {
                width: 200,
                height: 200,
                margin: 2,
                color: {
                    dark: '#1e40af',
                    light: '#ffffff'
                }
            }, function (error) {
                if (error) {
                    console.error('QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                    container.innerHTML = `
                        <div class="text-center text-red-600">
                            <div class="text-4xl mb-2">âš ï¸</div>
                            <p class="text-sm">QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ</p>
                        </div>
                    `;
                } else {
                    window.alsokStorage.addLog('QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ', 'é¢æ¥ç”¨QRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã—ãŸ', 'success');
                }
            });
        }
        
        // æœ€çµ‚æ›´æ–°æ™‚åˆ»æ›´æ–°
        function updateLastUpdated() {
            const now = new Date();
            document.getElementById('last-updated').textContent = 
                `æœ€çµ‚æ›´æ–°: ${now.toLocaleTimeString('ja-JP')}`;
        }
        
        // è‡ªå‹•æ›´æ–°é–‹å§‹
        function startAutoUpdate() {
            updateInterval = setInterval(() => {
                window.alsokStorage.updateStats();
                updateLastUpdated();
            }, 5000);
        }
        
        // æ—¥æ™‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatDateTime(dateString) {
            return new Date(dateString).toLocaleString('ja-JP', {
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        function formatTime(dateString) {
            return new Date(dateString).toLocaleTimeString('ja-JP', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
        function refreshData() {
            window.alsokStorage.updateStats();
            updateDashboard();
            window.alsokStorage.addLog('æ‰‹å‹•æ›´æ–°', 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’æ‰‹å‹•ã§æ›´æ–°ã—ã¾ã—ãŸ', 'info');
        }
        
        function regenerateQR() {
            generateQRCode();
        }
        
        function clearAllData() {
            if (confirm('ã™ã¹ã¦ã®ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                window.alsokStorage.clearAll();
                updateDashboard();
            }
        }
        
        function clearLogs() {
            if (confirm('ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                const data = window.alsokStorage.getData();
                data.systemLogs = [];
                window.alsokStorage.saveData(data);
                window.alsokStorage.addLog('ãƒ­ã‚°ã‚¯ãƒªã‚¢', 'ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'warning');
            }
        }
        
        function showApplicantDetails(applicantId) {
            const applicant = window.alsokStorage.getApplicant(applicantId);
            if (!applicant) return;
            
            const responses = applicant.responses.map((r, i) => 
                `Q${i+1}: ${r.question}\\nA${i+1}: ${r.answer}\\n`
            ).join('\\n');
            
            alert(`å¿œå‹Ÿè€…è©³ç´° - ${applicant.name}\\n\\n${responses}`);
        }
        
        // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        window.addEventListener('beforeunload', function() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        });
    </script>
</body>
</html>