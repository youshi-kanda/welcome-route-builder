# Google Apps Script (GAS) 連携セットアップガイド

ALSOK採用システムをGoogle Spreadsheetsと連携させるための完全ガイドです。

## 📋 概要

このシステムでは、応募者が事前確認を完了すると、自動的にお客様のGoogle Spreadsheetsにデータが送信されます。

### システム構成
```
応募者（スマホ/PC）
    ↓ 事前確認完了
ALSOK採用システム
    ↓ 自動データ送信
Google Apps Script (GAS)
    ↓ データ記録
Google Spreadsheets（お客様管理）
```

## 🚀 セットアップ手順

### ステップ1: Google Spreadsheetsでスプレッドシート作成

1. **Google Spreadsheetsにアクセス**
   - https://sheets.google.com にアクセス
   - Googleアカウントでログイン

2. **新しいスプレッドシートを作成**
   - 「空白」を選択して新規作成
   - ファイル名を「ALSOK応募者データ」に変更

3. **共有設定（重要）**
   - 右上の「共有」ボタンをクリック
   - 「リンクを知っている全員」に設定
   - 権限は「閲覧者」または「編集者」

### ステップ2: Google Apps Scriptの設定

1. **Apps Scriptエディタを開く**
   - スプレッドシートで「拡張機能」→「Apps Script」を選択
   - 新しいタブでApps Scriptエディタが開きます

2. **GASコードを貼り付け**
   - デフォルトのコードを全て削除
   - 提供されたGASコード（gas-script.js）を全てコピー&ペースト
   - 「Ctrl+S」で保存

3. **プロジェクト名を変更**
   - 左上の「無題のプロジェクト」をクリック
   - 「ALSOK採用システム連携」に名前変更

### ステップ3: Web Appとしてデプロイ

1. **デプロイの準備**
   - 右上の「デプロイ」ボタンをクリック
   - 「新しいデプロイ」を選択

2. **デプロイ設定**
   ```
   タイプ: ウェブアプリ
   説明: ALSOK採用システム連携 v1.0
   次のユーザーとして実行: 自分
   アクセスできるユーザー: 全員
   ```

3. **権限の承認**
   - 「承認」ボタンをクリック
   - Googleアカウントを選択
   - 「詳細」→「ALSOK採用システム連携（安全ではないページ）に移動」
   - 「許可」をクリック

4. **Web App URLを取得**
   - デプロイ完了後に表示されるURLをコピー
   - 形式: `https://script.google.com/macros/s/[ID]/exec`

### ステップ4: ALSOK採用システムでの設定

1. **GAS設定ページにアクセス**
   - ALSOK採用システムの管理画面から「GAS設定」をクリック
   - または直接 `/gas-setup` にアクセス

2. **Web App URLを設定**
   - ステップ3で取得したURLを入力
   - 「GAS連携を有効にする」にチェック
   - 「設定を保存」をクリック

3. **接続テスト**
   - 「接続テスト」ボタンをクリック
   - 「✅ 接続テスト成功」が表示されることを確認

## 🧪 テスト方法

### 1. 基本動作テスト
```bash
# GAS設定ページで実行
1. 接続テスト → 成功確認
2. 単体データ送信 → スプレッドシートに1行追加確認
3. 複数データ送信 → 複数行追加確認
```

### 2. 実際の運用テスト
```bash
# 実際の応募フローをテスト
1. /mobile にアクセス
2. 応募者情報を入力
3. 事前確認を完了
4. スプレッドシートにデータ反映確認
```

## 📊 データ構造

スプレッドシートには以下27列のデータが記録されます：

### 基本情報 (A-D列)
- **A列**: 応募日時
- **B列**: 応募者名  
- **C列**: 電話番号
- **D列**: 応募経路

### 11ステップ回答 (E-O列)
- **E列**: 年齢確認
- **F列**: 国籍確認
- **G列**: 過去の逮捕歴
- **H列**: 暴力団関係
- **I列**: 精神的な病気
- **J列**: アルコール依存症
- **K列**: 薬物依存症
- **L列**: 住居確認
- **M列**: 連絡先確認
- **N列**: 面接希望
- **O列**: 特記事項

### 結果・技術情報 (P-AA列)
- **P列**: 失格状況（自動判定）
- **Q列**: 総合結果
- **R列**: 完了時間
- **S列**: デバイス種別
- **T-AA列**: 技術情報（IP、セッション等）

## ⚙️ 高度な設定

### 1. 自動整理機能
GASには以下の自動機能が含まれています：
- **自動ソート**: 応募日時順にデータを整理
- **重複チェック**: 電話番号ベースで重複応募を検出
- **データ検証**: 必須項目の入力確認
- **統計情報**: 適格率や応募数の自動計算

### 2. 条件付き書式
- **適格者**: 緑背景で表示
- **不適格者**: 赤背景で表示
- **データ検証エラー**: 該当セルを赤背景

### 3. アクセス制御
```javascript
// スプレッドシート上でのメニュー追加
ALSOK採用システム → 初期設定実行
ALSOK採用システム → テストデータ追加
ALSOK採用システム → 統計情報更新
ALSOK採用システム → データ検証実行
```

## 🔧 トラブルシューティング

### よくある問題と解決方法

#### 1. 「接続テストに失敗する」
```
原因: Web App URLが正しくない
解決: デプロイ時に生成されたURLを正確にコピー

原因: GASの権限が不足
解決: デプロイ時に「全員」アクセス許可を設定
```

#### 2. 「データが送信されない」
```
原因: CORS設定の問題
解決: GASコードが正しく設定されているか確認

原因: GAS連携が無効
解決: システム設定でGAS連携を有効化
```

#### 3. 「重複データが作成される」
```
原因: 同じ電話番号での複数応募
解決: GASが自動で重複チェックを実行（正常動作）
```

#### 4. 「スプレッドシートが更新されない」
```
原因: スプレッドシート権限の問題
解決: 共有設定を「リンクを知っている全員」に変更
```

## 📞 サポート

### 設定支援
技術的な設定でお困りの場合は、以下の情報をご準備の上、お問い合わせください：

1. **Google Apps ScriptのプロジェクトURL**
2. **エラーメッセージのスクリーンショット**
3. **スプレッドシートの共有URL**
4. **実行ログ**（GASデモページから取得可能）

### メンテナンス
- **定期バックアップ**: スプレッドシートデータの定期的なバックアップを推奨
- **ログ監視**: GASの実行ログを定期的に確認
- **権限更新**: 必要に応じてGASの権限を更新

## 🎯 運用開始チェックリスト

### デプロイ前確認
- [ ] スプレッドシートが正しく作成されている
- [ ] GASコードがエラーなくデプロイされている  
- [ ] Web App URLが取得できている
- [ ] ALSOK採用システムでGAS設定が完了している
- [ ] 接続テストが成功している
- [ ] テストデータ送信が正常に動作している

### 運用開始後
- [ ] 実際の応募者データが正しく記録される
- [ ] 重複チェック機能が動作している
- [ ] 統計情報が正しく表示される
- [ ] 権限設定が適切である

---

## 📚 関連リソース

- **ALSOK採用システム管理画面**: `/admin`
- **GAS設定ページ**: `/gas-setup`
- **GASデモページ**: `/gas-demo`
- **Google Apps Script公式ドキュメント**: https://developers.google.com/apps-script

このガイドに従って設定を行えば、ALSOK採用システムとGoogle Spreadsheetsの連携が完了します。